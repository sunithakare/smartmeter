<div class="mat-typography" fxLayoutAlign="center center">
  <h1>Approval List</h1>
</div>

<mat-tab-group
  mat-stretch-tabs
  color="primary"
  [(selectedIndex)]="selectIndex"
  #tabGroup
  class="mat-elevation-z8"
>
  <mat-tab label="List" style="border-right: 2px outset rgba(1, 75, 136, 0.27)">
    <ng-template matTabContent>
      <mat-accordion>
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title> Table Filter </mat-panel-title>
            <mat-panel-description> Expand Table Filter </mat-panel-description>
          </mat-expansion-panel-header>
          <ng-template matExpansionPanelContent>
            <form [formGroup]="searcherForm">
            <div fxLayout="row" fxLayoutAlign="space-between center">
               <mat-form-field appearance="fill" style="width: 256px">
                <mat-label>State</mat-label>
                <mat-select (selectionChange)="onChangeOfState($event)" formControlName="state">
                  <mat-option *ngFor="let type of stateList" [value]="type.value" >{{ type.name }}</mat-option>
                </mat-select>
              </mat-form-field>
              <mat-form-field appearance="fill" style="width: 256px">
               <mat-label>Discom</mat-label>
               <mat-select (selectionChange)="onChangeOfDiscom($event)" formControlName="discom">
                 <mat-option *ngFor="let type of discomList" [value]="type.value" >{{ type.name }}</mat-option>
               </mat-select>
             </mat-form-field>
              <mat-form-field appearance="fill" style="width: 256px">
               <mat-label>City</mat-label>
               <mat-select (selectionChange)="onChangeOfCity($event)" formControlName="city">
                 <mat-option *ngFor="let type of cityList" [value]="type.value" >{{ type.name }}</mat-option>
               </mat-select>
             </mat-form-field>
              <mat-form-field appearance="fill" style="width: 256px">
                <mat-label>Division</mat-label>
                <mat-select (selectionChange)="onChangeOfDivision($event)" formControlName="division">
                  <mat-option *ngFor="let type of divisionList" [value]="type.value" >{{ type.name }}</mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <div fxLayout="row" fxLayoutAlign="space-between center">
              <mat-form-field appearance="fill" style="width: 256px">
                <mat-label>Sub Division</mat-label>
                <mat-select (selectionChange)="onChangeOfSubDivision($event)" formControlName="subDivision">
                  <mat-option *ngFor="let type of subDivisionList" [value]="type.value" >{{ type.name }}</mat-option>
                </mat-select>
              </mat-form-field>
              <mat-form-field appearance="fill" style="width: 256px">
                <mat-label>Sub Station</mat-label>
                <mat-select (selectionChange)="onChangeOfSubStation($event)" formControlName="subStation">
                  <mat-option *ngFor="let type of subStationList" [value]="type.value" >{{ type.name }}</mat-option>
                </mat-select>
              </mat-form-field>
              <mat-form-field appearance="fill" style="width: 256px">
                <mat-label>Feeder</mat-label>
                <mat-select  formControlName="feeder">
                  <mat-option *ngFor="let type of feederList" [value]="type.value" >{{ type.name }}</mat-option>
                </mat-select>
              </mat-form-field>
              <mat-form-field appearance="fill" style="width: 256px">
              <mat-date-range-input [rangePicker]="picker">
                <input matStartDate placeholder="Start date" formControlName="start" />
                <input matEndDate  placeholder="End date"  formControlName="end"/>
              </mat-date-range-input>


              <mat-datepicker-toggle
                matSuffix
                [for]="picker"
              ></mat-datepicker-toggle>
              <mat-date-range-picker #picker></mat-date-range-picker>
            </mat-form-field>
            </div>
            <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="100px">

              <mat-form-field appearance="fill"  style="width: 256px">
                <mat-label>Consumer No</mat-label>
                <!-- <input matInput type="text" [(ngModel)]="consumerNo"> -->
                <input matInput type="text"  formControlName="consumerNo">
               </mat-form-field>
            </div>

            <div fxLayout="row" fxLayoutAlign="center center" fxLayoutGap="100px">
              <button mat-stroked-button color="primary"  style="margin-left: 10px;" (click)="loadDataWithFilter()"> <mat-icon>search</mat-icon> </button>
              </div>
          </form>

          </ng-template>
        </mat-expansion-panel>


      </mat-accordion>
<div fxLayout="row" fxLayoutAlign="space-between center" style="margin-top: 20px;margin-bottom: 20px;" *ngIf="type!='Reject' && type!='Approved'">
  <button mat-raised-button type="button" color="primary" dir="rtl" fxFlexOffset="10" fxFlex="10" (click)="handleApprovalAction('Approved')">Approvee</button>
  <button mat-raised-button type="button" color="warn" dir="rtl" fxFlexOffset="10" fxFlex="10" (click)="handleApprovalAction('Reject')">Reject</button>
  <button mat-raised-button type="button" color="accent" dir="rtl" fxFlexOffset="10" fxFlex="10" (click)="handleApprovalAction('Hold')"  *ngIf="type!='New'">Hold</button>
  <input hidden type="file" #uploader  (change)="uploadApprovalFile($event)"  accept=".xlsx"/>
  <button mat-raised-button type="button" color="primary" (click)="uploader.click()" >
    Upload File <mat-icon>upload</mat-icon>
</button>
  <button mat-button color="primary"   (click)="exportToExcel()"> Export To Excel <mat-icon>download</mat-icon> </button>
</div>


      <div style="overflow-x: scroll"
      fxLayout="column">
        <mat-progress-bar mode="indeterminate" *ngIf="isLoading">
        </mat-progress-bar>

        <mat-table [dataSource]="dataSource" class="mat-elevation-z8" style="width: 200%;">
          <ng-container matColumnDef="selectAll" >
            <mat-header-cell *matHeaderCellDef class="TableHeader" >
              <mat-checkbox (change)="selectAllOptional($event)" [(ngModel)]="allSelected"></mat-checkbox >
              </mat-header-cell >
            <mat-cell *matCellDef="let val" class="TableDataCell" >
              <mat-checkbox  [(ngModel)]='val["selected"]' (change)="checkAllSelcted($event)"></mat-checkbox >
              </mat-cell>
          </ng-container>

          <ng-container matColumnDef="consumerNo">
            <mat-header-cell *matHeaderCellDef class="TableHeader" >Consumer No</mat-header-cell >
            <mat-cell *matCellDef="let val" class="TableDataCell"> <a (click)="showDetails(val)" style="color: cadetblue;">{{ val["consumerNo"] }}</a> </mat-cell>
          </ng-container>
          <ng-container matColumnDef="mobileNo">
            <mat-header-cell *matHeaderCellDef class="TableHeader" >Mobile No</mat-header-cell >
            <mat-cell *matCellDef="let val" class="TableDataCell">{{ val["mobile"] }}</mat-cell>
          </ng-container>
          <ng-container matColumnDef="ciDate">
            <mat-header-cell *matHeaderCellDef class="TableHeader" >CI Date</mat-header-cell >
            <mat-cell *matCellDef="let val" class="TableDataCell">{{ val["createdDate"] }}</mat-cell>
          </ng-container>
          <ng-container matColumnDef="latitudelongitude">
            <mat-header-cell *matHeaderCellDef class="TableHeader" >Latitude/Longitude</mat-header-cell >
            <mat-cell *matCellDef="let val" class="TableDataCell">{{ val["longitudeLatitude"] }}</mat-cell>
          </ng-container>
          <ng-container matColumnDef="signalStrength">
            <mat-header-cell *matHeaderCellDef class="TableHeader" >SignalStrength</mat-header-cell >
            <mat-cell *matCellDef="let val" class="TableDataCell">{{ val["signaleStrength"] }}</mat-cell>
          </ng-container>
          <ng-container matColumnDef="division">
            <mat-header-cell *matHeaderCellDef class="TableHeader" >Division</mat-header-cell >
            <mat-cell *matCellDef="let val" class="TableDataCell">{{ val["division"] }}</mat-cell>
          </ng-container>
          <ng-container matColumnDef="subDivision">
            <mat-header-cell *matHeaderCellDef class="TableHeader" >Sub Division</mat-header-cell >
            <mat-cell *matCellDef="let val" class="TableDataCell">{{ val["subDivision"] }}</mat-cell>
          </ng-container>
          <ng-container matColumnDef="subStation">
            <mat-header-cell *matHeaderCellDef class="TableHeader" >SubStation</mat-header-cell >
            <mat-cell *matCellDef="let val" class="TableDataCell">{{ val["subStation"] }}</mat-cell>
          </ng-container>
          <ng-container matColumnDef="feeder">
            <mat-header-cell *matHeaderCellDef class="TableHeader" >Feeder</mat-header-cell >
            <mat-cell *matCellDef="let val" class="TableDataCell">{{ val["feeder"] }}</mat-cell>
          </ng-container>
          <ng-container matColumnDef="dtr">
            <mat-header-cell *matHeaderCellDef class="TableHeader" >DTR</mat-header-cell >
            <mat-cell *matCellDef="let val" class="TableDataCell">{{ val["dtr"] }}</mat-cell>
          </ng-container>
          <ng-container matColumnDef="pole">
            <mat-header-cell *matHeaderCellDef class="TableHeader" >Pole</mat-header-cell >
            <mat-cell *matCellDef="let val" class="TableDataCell">{{ val["pole"] }}</mat-cell>
          </ng-container>
          <ng-container matColumnDef="oldMeterNo">
            <mat-header-cell *matHeaderCellDef class="TableHeader" >Old Meter No</mat-header-cell >
            <mat-cell *matCellDef="let val" class="TableDataCell">{{ val["meterNo"] }}</mat-cell>
          </ng-container>
          <ng-container matColumnDef="address">
            <mat-header-cell *matHeaderCellDef class="TableHeader" >Address</mat-header-cell >
            <mat-cell *matCellDef="let val" class="TableDataCell">{{ val["address"] }}</mat-cell>
          </ng-container>
          <ng-container matColumnDef="exceptions">
            <mat-header-cell *matHeaderCellDef class="TableHeader" >Exceptions</mat-header-cell >
            <mat-cell *matCellDef="let val" class="TableDataCell">{{ val["remarks"] }}</mat-cell>
          </ng-container>
          <ng-container matColumnDef="status">
            <mat-header-cell *matHeaderCellDef class="TableHeader" >Status</mat-header-cell >
            <mat-cell *matCellDef="let val" class="TableDataCell">{{ val["status"] }}</mat-cell>
          </ng-container>
          <mat-header-row *matHeaderRowDef="displayColumns" ></mat-header-row>
          <mat-row matRipple *matRowDef="let row; columns: displayColumns"  ></mat-row>
        </mat-table>

      </div>
      <mat-paginator [length]="totalRows" [pageSize]="pageSize" [pageIndex]="currentPage" [pageSizeOptions]="pageSizeOptions" showFirstLastButtons aria-label="Select page" ></mat-paginator>
    </ng-template>
  </mat-tab>

  <mat-tab
    label="Details"
    style="border-right: 2px outset rgba(1, 75, 136, 0.27)"
    *ngIf="type!='Reject'"
  >

  <app-ci-approval-details  [isEditable]="isEditable"  [ciDataForEdit]="ciDataForEdit" (dataSaved)="loadListTab()"></app-ci-approval-details>
  </mat-tab>

</mat-tab-group>

<div class="overlay" *ngIf="spinner">
  <div class="spinner">
    <mat-progress-spinner diameter="50" mode="indeterminate" color="accent">
    </mat-progress-spinner>
  </div>
  </div>
